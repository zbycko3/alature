"use strict";var REQUIRED_FIELDS=["phone","name","address","postal_code","prefecture","city"],SEND_URL="/order/create_temporary/",NO_AUTOSAVE_FIELD="no_autosave_orders",TIMEOUT_PERIOD=3e3,request_sended=!1,sender=function(){saver.data.forEach(function(e){var r=!0;for(var t in e.required){if(e.required.hasOwnProperty(t)&&!e.required[t].is_valid){r=!1;break}e.form[t]=e.required[t].value}r&&!request_sended&&(request_sended=!0,$.post(SEND_URL,e.form,function(e){"ok"!==e.status&&console.log("Error during creating temporary order, error: "+e.message)},"json"))})},timeout={start:function(){var e;return function(){clearTimeout(e),!timeout.stop&&(e=setTimeout(sender,TIMEOUT_PERIOD))}},stop:!1},timeoutResetter=timeout.start(),saver={data:[],listener:function(e){request_sended=!1;var t=e.target;saver.data.forEach(function(e,r){e.required[t.name]&&e.required[t.name].value!==t.value&&t.value!==e.required[t.name].placeholder&&(saver.data[r].required[t.name].value=t.value,saver.data[r].required[t.name].is_valid=!0,timeoutResetter())})},init:function(){var e=$("form");if(e.length)for(var r=0;r<e.length;r++){for(var t=e[r],a={form:{},required:{}},n=0;n<t.elements.length;n++){var o=t.elements[n];if(o.name===NO_AUTOSAVE_FIELD&&1==o.value)return;a.form[o.name]=o.value}a.form.user_agent=navigator.userAgent,REQUIRED_FIELDS.forEach(function(e){var r=t.elements[e];void 0!==r&&"none"!==r.style.display&&"hidden"!==r.type&&($(r).on("keyup",saver.listener),a.required[e]={value:r.value,is_valid:!1,placeholder:"undefined"!==r.attributes.placeholder?"":r.attributes.placeholder.value})}),a.user_agent=navigator.userAgent,saver.data.push(a)}}};$(document).ready(function(){saver.init(),$("form button, form input[type=submit]").click(function(){timeout.stop=!0,timeoutResetter()})});